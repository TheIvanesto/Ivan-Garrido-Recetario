<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recetario - Autocontenido</title>
  <style>
  /* variables */
  :root{ --bg:#fff9f4; --surface:#fff; --text:#2b2b2b; --muted:#7a6b5a; --primary:#c84b31; --accent:#ffb86b; --green:#6cab7d; --radius-lg:1rem; --gap:1rem; --max-width:1100px }
  [data-theme="dark"]{ --bg:#0f1410; --surface:#121613; --text:#e9efe6; --muted:#98a48f; --primary:#ff8a66; --accent:#ffd9a6; --green:#7fd6a5 }
  /* main */
  html,body{margin:0;height:100%;font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:var(--bg);color:var(--text)}
  .app{max-width:var(--max-width);margin:0 auto;padding:var(--gap)}
  header.nav{display:flex;gap:1rem;align-items:center;padding:0.5rem 0}
  header.nav a{color:var(--primary);text-decoration:none}
  .searchbar input{width:100%;padding:.6rem;border-radius:.5rem;border:1px solid #ddd}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;margin-top:1rem}
  .card{background:var(--surface);border-radius:.75rem;box-shadow:0 6px 18px rgba(0,0,0,.06);overflow:hidden;padding:0;display:flex;flex-direction:column}
  .card .poster{height:120px;background:linear-gradient(90deg,var(--accent),var(--primary));color:#fff;display:flex;align-items:center;padding:0 1rem}
  .card .body{padding:.75rem}
  .card .actions{display:flex;gap:.5rem;padding:.5rem}
  .btn{background:var(--primary);color:#fff;padding:.5rem .75rem;border-radius:.5rem;border:none;cursor:pointer}
  .muted{color:var(--muted)}
  main.section{margin-top:1rem}
  .portion-controls{display:flex;gap:.5rem;align-items:center}
  .ingredients-list{list-style:none;padding:0}
  .planner-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:.5rem;margin-top:.5rem}
  .planner-cell{min-height:80px;border:1px dashed #eee;padding:.5rem;border-radius:.5rem;background:var(--surface)}
  footer{margin-top:2rem;padding-top:1rem;border-top:1px solid #eee;color:var(--muted)}
  .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header class="nav">
      <strong>Recetario</strong>
      <nav aria-label="principal">
        <a href="#/catalogo">Catálogo</a> · <a href="#/planner">Planner</a> · <a href="#/lista-compra">Lista de compra</a>
      </nav>
      <div style="flex:1"></div>
      <div style="width:280px"><input id="search" placeholder="Buscar recetas, ingredientes..." aria-label="Buscar recetas" /></div>
    </header>

    <main id="view"></main>

    <div id="aria-live" class="visually-hidden" aria-live="polite"></div>

    <footer>
      Proyecto demo - archivo autocontenido para abrir en Chrome (file://). Algunas funciones offline o SW no están disponibles en file://.
    </footer>
  </div>

  <script>
  // Data: 12 recetas (inline para archivo autocontenido)
  const RECIPES = [
  {"id":"r1","title":"Tostadas mediterráneas","servings":2,"prepTime":10,"cookTime":5,"difficulty":"fácil","cuisine":"Mediterránea","tags":["vegetariano","rápido"],"ingredients":[{"name":"pan rústico","quantity":4,"unit":"unit"},{"name":"tomate","quantity":2,"unit":"unit"},{"name":"aceite de oliva","quantity":2,"unit":"tbsp"}],"steps":[{"text":"Tostar el pan.","time":2},{"text":"Frotar tomate y aliñar.","time":0}],"rating":4.5,"votes":120,"author":"A. Cocina","description":"Tostadas sencillas con tomate y aceite."},
  {"id":"r2","title":"Curry de garbanzos","servings":4,"prepTime":15,"cookTime":30,"difficulty":"medio","cuisine":"India","tags":["vegano","sin-gluten"],"ingredients":[{"name":"garbanzos cocidos","quantity":400,"unit":"g"},{"name":"leche de coco","quantity":200,"unit":"ml"},{"name":"cebolla","quantity":1,"unit":"unit"}],"steps":[{"text":"Pochar cebolla y especias.","time":5},{"text":"Añadir garbanzos y leche de coco, cocinar.","time":20}],"rating":4.7,"votes":254,"author":"M. Vegan","description":"Curry cremoso y aromático."},
  {"id":"r3","title":"Brownie clásico","servings":8,"prepTime":15,"cookTime":25,"difficulty":"fácil","cuisine":"Internacional","tags":["postre"],"ingredients":[{"name":"chocolate negro","quantity":200,"unit":"g"},{"name":"mantequilla","quantity":150,"unit":"g"},{"name":"azúcar","quantity":200,"unit":"g"},{"name":"huevos","quantity":3,"unit":"unit"}],"steps":[{"text":"Derretir chocolate y mantequilla.","time":5},{"text":"Mezclar y hornear.","time":25}],"rating":4.8,"votes":1021,"author":"La Repostera","description":"Brownie húmedo con corteza crujiente."},
  {"id":"r4","title":"Avena overnight con frutas","servings":2,"prepTime":10,"cookTime":0,"difficulty":"fácil","cuisine":"Internacional","tags":["vegano","desayuno"],"ingredients":[{"name":"copos de avena","quantity":100,"unit":"g"},{"name":"leche vegetal","quantity":300,"unit":"ml"},{"name":"frutas mixtas","quantity":150,"unit":"g"}],"steps":[{"text":"Mezclar y reposar en frío toda la noche.","time":0}],"rating":4.2,"votes":64,"author":"Saludable","description":"Rápido y nutritivo para desayunos."},
  {"id":"r5","title":"Ensalada de quinoa y aguacate","servings":3,"prepTime":15,"cookTime":15,"difficulty":"fácil","cuisine":"Mediterránea","tags":["vegetariano","sin-gluten"],"ingredients":[{"name":"quinoa","quantity":200,"unit":"g"},{"name":"aguacate","quantity":2,"unit":"unit"}],"steps":[{"text":"Cocer quinoa y mezclar con resto de ingredientes.","time":10}],"rating":4.4,"votes":88,"author":"Huerta","description":"Fresca y saciante."},
  {"id":"r6","title":"Sopa de lentejas","servings":4,"prepTime":15,"cookTime":40,"difficulty":"medio","cuisine":"Internacional","tags":["vegano"],"ingredients":[{"name":"lentejas","quantity":300,"unit":"g"},{"name":"zanahoria","quantity":2,"unit":"unit"}],"steps":[{"text":"Cocer y sazonar.","time":30}],"rating":4.3,"votes":140,"author":"Cocinero","description":"Sopa reconfortante."},
  {"id":"r7","title":"Pasta al pesto","servings":2,"prepTime":10,"cookTime":10,"difficulty":"fácil","cuisine":"Italiana","tags":["vegetariano"],"ingredients":[{"name":"pasta","quantity":200,"unit":"g"},{"name":"pesto","quantity":80,"unit":"g"}],"steps":[{"text":"Cocinar pasta y mezclar con pesto.","time":10}],"rating":4.6,"votes":512,"author":"Nonna","description":"Clásico italiano."},
  {"id":"r8","title":"Tacos de pescado","servings":4,"prepTime":20,"cookTime":10,"difficulty":"medio","cuisine":"Mexicana","tags":["mariscos"],"ingredients":[{"name":"filete de pescado","quantity":400,"unit":"g"},{"name":"tortillas","quantity":8,"unit":"unit"}],"steps":[{"text":"Cocinar y montar tacos.","time":10}],"rating":4.1,"votes":201,"author":"Mar","description":"Tacos frescos y sabrosos."},
  {"id":"r9","title":"Pollo al horno con hierbas","servings":4,"prepTime":15,"cookTime":60,"difficulty":"medio","cuisine":"Mediterránea","tags":["principal"],"ingredients":[{"name":"pollo entero","quantity":1,"unit":"unit"},{"name":"patatas","quantity":500,"unit":"g"}],"steps":[{"text":"Hornear hasta dorar.","time":60}],"rating":4.5,"votes":330,"author":"Asador","description":"Plato familiar."},
  {"id":"r10","title":"Crema de calabaza","servings":4,"prepTime":15,"cookTime":30,"difficulty":"fácil","cuisine":"Internacional","tags":["vegano","sopa"],"ingredients":[{"name":"calabaza","quantity":700,"unit":"g"},{"name":"caldo vegetal","quantity":500,"unit":"ml"}],"steps":[{"text":"Cocer y triturar.","time":20}],"rating":4.0,"votes":76,"author":"SopaChef","description":"Suave y otoñal."},
  {"id":"r11","title":"Ensalada César","servings":2,"prepTime":10,"cookTime":0,"difficulty":"fácil","cuisine":"Internacional","tags":["ensalada"],"ingredients":[{"name":"lechuga","quantity":1,"unit":"unit"},{"name":"pollo a la plancha","quantity":200,"unit":"g"}],"steps":[{"text":"Montar ensalada.","time":0}],"rating":4.2,"votes":89,"author":"ChefSalud","description":"Clásica con aderezo cremoso."},
  {"id":"r12","title":"Pancakes esponjosos","servings":4,"prepTime":15,"cookTime":10,"difficulty":"fácil","cuisine":"Internacional","tags":["desayuno","postre"],"ingredients":[{"name":"harina","quantity":250,"unit":"g"},{"name":"leche","quantity":300,"unit":"ml"},{"name":"huevo","quantity":2,"unit":"unit"}],"steps":[{"text":"Mezclar y cocinar en sartén.","time":8}],"rating":4.7,"votes":412,"author":"Desayunos","description":"Perfectos para brunch."}
  ];

  // small utils
  function q(sel, el=document){ return el.querySelector(sel); }
  function debounce(fn, wait=300){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),wait); }; }
  function formatFraction(v){ if (Math.abs(v - Math.round(v)) < 1e-6) return String(Math.round(v)); const whole = Math.floor(v); const frac = v - whole; const maxDen=8; let best={n:0,d:1,diff:1}; for(let d=1; d<=maxDen; d++){ const n=Math.round(frac*d); const diff=Math.abs(frac - n/d); if(diff<best.diff){best={n,d,diff};}} if(best.n===0) return String(whole); const g=(a,b)=>b?g(b,a%b):a; const gg=g(best.n,best.d); const n=best.n/gg; const d=best.d/gg; return (whole?whole+' ':'')+n+'/'+d; }
  function convertDisplay(qty, unit) {
    if (!unit) return { value: qty, unit: '' };
    // Normalize grams / kilograms
    if (unit === 'g' || unit === 'kg') {
      const grams = unit === 'kg' ? qty * 1000 : qty;
      if (Math.abs(grams) >= 1000) {
        // show as kg with two decimals
        return { value: Math.round((grams / 1000) * 100) / 100, unit: 'kg' };
      }
      return { value: Math.round(grams), unit: 'g' };
    }
    // Normalize milliliters / liters
    if (unit === 'ml' || unit === 'l') {
      const ml = unit === 'l' ? qty * 1000 : qty;
      if (Math.abs(ml) >= 1000) {
        return { value: Math.round((ml / 1000) * 100) / 100, unit: 'l' };
      }
      return { value: Math.round(ml), unit: 'ml' };
    }
    // Default: return as-is
    return { value: qty, unit: unit };
  }

  // routing
  function navigate(){ const hash=location.hash || '#/catalogo'; const view=q('#view'); view.innerHTML=''; if(hash.startsWith('#/catalogo')) return renderCatalog(); if(hash.startsWith('#/receta/')){ const id=hash.split('/')[2]; return renderRecipe(id); } if(hash.startsWith('#/planner')) return renderPlanner(); if(hash.startsWith('#/lista-compra')) return renderShopping(); return renderCatalog(); }

  // search
  const searchInput=q('#search'); searchInput.addEventListener('input', debounce(()=>{ const v=searchInput.value.trim().toLowerCase(); renderCatalog(v); },300));

  // catalog
  function renderCatalog(qterm=''){ const view=q('#view'); view.innerHTML=''; const section=document.createElement('section'); section.className='section'; const grid=document.createElement('div'); grid.className='grid'; const list = RECIPES.filter(r=>{ if(!qterm) return true; return r.title.toLowerCase().includes(qterm) || (r.description||'').toLowerCase().includes(qterm) || r.ingredients.some(i=>i.name.toLowerCase().includes(qterm)); }); list.forEach(r=>{ const card=document.createElement('article'); card.className='card'; card.innerHTML=`<div class="poster"><strong>${r.title}</strong></div><div class="body"><h4>${r.title}</h4><p class="muted">${r.cuisine} • ${r.difficulty} • ${r.prepTime + (r.cookTime||0)} min</p></div>`; const actions=document.createElement('div'); actions.className='actions'; const viewBtn=document.createElement('button'); viewBtn.className='btn'; viewBtn.textContent='Ver'; viewBtn.addEventListener('click', ()=> location.hash = '#/receta/'+r.id); const addBtn=document.createElement('button'); addBtn.textContent='Añadir al planner'; addBtn.addEventListener('click', ()=>{ addToPlanner(r.id); alert('Añadido al planner (puedes editar en Planner)'); }); actions.appendChild(viewBtn); actions.appendChild(addBtn); card.appendChild(actions); grid.appendChild(card); }); section.appendChild(grid); view.appendChild(section); }

  // recipe detail
  function renderRecipe(id){ const r = RECIPES.find(x=>x.id===id); const view=q('#view'); if(!r){ view.innerHTML='<p>Receta no encontrada</p>'; return; } view.innerHTML=''; const sec=document.createElement('section'); sec.className='section'; sec.innerHTML=`<h2>${r.title}</h2><p class="muted">${r.cuisine} • ${r.difficulty} • ${r.prepTime + (r.cookTime||0)} min</p><p>${r.description||''}</p>`; // portion scaler
    const scalerDiv=document.createElement('div'); scalerDiv.className='portion-controls'; let servings = r.servings || 1; const lbl=document.createElement('div'); lbl.textContent = 'Porciones: '+servings; const dec=document.createElement('button'); dec.textContent='-'; const inc=document.createElement('button'); inc.textContent='+'; dec.addEventListener('click', ()=>{ if(servings>1) servings--; lbl.textContent='Porciones: '+servings; renderIngredients(); localStorage.setItem('servings:'+r.id,servings); }); inc.addEventListener('click', ()=>{ servings++; lbl.textContent='Porciones: '+servings; renderIngredients(); localStorage.setItem('servings:'+r.id,servings); }); scalerDiv.appendChild(dec); scalerDiv.appendChild(lbl); scalerDiv.appendChild(inc); sec.appendChild(scalerDiv);
    const ingList=document.createElement('ul'); ingList.className='ingredients-list'; function renderIngredients(){ ingList.innerHTML=''; (r.ingredients||[]).forEach(ing=>{ const qty=(ing.quantity * servings)/r.servings; const disp=convertDisplay(qty,ing.unit||''); const text = (isFinite(qty)?formatFraction(Math.round(qty*100)/100):qty)+' '+(disp.unit||'')+' '+ing.name; const li=document.createElement('li'); li.textContent=text; ingList.appendChild(li); }); } renderIngredients(); sec.appendChild(ingList);
    const stepsOl=document.createElement('ol'); (r.steps||[]).forEach(s=>{ const li=document.createElement('li'); const p=document.createElement('div'); p.textContent=s.text; li.appendChild(p); if(s.time && s.time>0){ const controls=document.createElement('div'); const start=document.createElement('button'); start.textContent='Start'; const pause=document.createElement('button'); pause.textContent='Pause'; const reset=document.createElement('button'); reset.textContent='Reset'; const display=document.createElement('span'); let t=s.time*60; display.textContent = s.time+':00'; let interval=null; function render(){ const m=Math.floor(t/60); const ss=t%60; display.textContent=m+':'+String(ss).padStart(2,'0'); } start.addEventListener('click', ()=>{ if(interval) return; interval=setInterval(()=>{ if(t<=0){ clearInterval(interval); interval=null; try{ new Notification('Temporizador',{body:`Paso ${s.text} finalizado`}); }catch(e){ display.style.opacity='0.3'; } return; } t--; render(); },1000); }); pause.addEventListener('click', ()=>{ if(interval){ clearInterval(interval); interval=null; } }); reset.addEventListener('click', ()=>{ t=s.time*60; render(); if(interval){ clearInterval(interval); interval=null; } }); controls.appendChild(display); controls.appendChild(start); controls.appendChild(pause); controls.appendChild(reset); li.appendChild(controls); }
      stepsOl.appendChild(li); }); sec.appendChild(stepsOl);
    view.appendChild(sec);
  }

  // planner
  function addToPlanner(id){ const planner = JSON.parse(localStorage.getItem('planner')||'{}'); planner['mon-breakfast']=planner['mon-breakfast']||[]; planner['mon-breakfast'].push(id); localStorage.setItem('planner',JSON.stringify(planner)); }
  function renderPlanner(){ const view=q('#view'); view.innerHTML=''; const sec=document.createElement('section'); sec.className='section'; sec.innerHTML='<h2>Planner semanal</h2><p>Drag & drop no disponible en versión file://, usa "Añadir al planner" en catálogo para poblar.</p>'; const grid=document.createElement('div'); grid.className='planner-grid'; const days=['Lun','Mar','Mié','Jue','Vie','Sáb','Dom']; for(let d=0; d<7; d++){ const cell=document.createElement('div'); cell.className='planner-cell'; cell.dataset.day=d; const h=document.createElement('h4'); h.textContent=days[d]; cell.appendChild(h); grid.appendChild(cell); } sec.appendChild(grid); // render items
    const planner=JSON.parse(localStorage.getItem('planner')||'{}'); Object.keys(planner).forEach(k=>{ const ids=planner[k]; ids.forEach(id=>{ const r=RECIPES.find(rr=>rr.id===id); const el=document.createElement('div'); el.textContent=r? r.title : id; el.style.background='var(--accent)'; el.style.margin='4px 0'; el.style.padding='2px 4px'; grid.children[0].appendChild(el); }); }); view.appendChild(sec); }

  // shopping list
  function renderShopping(){ const view=q('#view'); view.innerHTML=''; const sec=document.createElement('section'); sec.className='section'; sec.innerHTML='<h2>Lista de compra</h2>'; const btn=document.createElement('button'); btn.textContent='Generar desde planner'; btn.className='btn'; sec.appendChild(btn); const ul=document.createElement('ul'); sec.appendChild(ul); btn.addEventListener('click', ()=>{ const planner=JSON.parse(localStorage.getItem('planner')||'{}'); const items={}; Object.values(planner).flat().forEach(id=>{ const r=RECIPES.find(rr=>rr.id===id); if(!r) return; r.ingredients.forEach(ing=>{ const key=ing.name.toLowerCase().trim()+'|'+(ing.unit||''); if(!items[key]) items[key]={name:ing.name,qty:0,unit:ing.unit||''}; const cur=items[key]; // sum compatible g/kg/ml/l
      if((cur.unit==='g'&&ing.unit==='kg')||(cur.unit==='kg'&&ing.unit==='g')){ const aq=cur.unit==='kg'?cur.qty*1000:cur.qty; const bq=ing.unit==='kg'?ing.quantity*1000:ing.quantity; cur.qty = aq + bq; cur.unit='g'; }
      else if((cur.unit==='ml'&&ing.unit==='l')||(cur.unit==='l'&&ing.unit==='ml')){ const aq=cur.unit==='l'?cur.qty*1000:cur.qty; const bq=ing.unit==='l'?ing.quantity*1000:ing.quantity; cur.qty=aq+bq; cur.unit='ml'; }
      else if(cur.unit===ing.unit) cur.qty+=ing.quantity; else cur.qty+=ing.quantity; }); }); ul.innerHTML=''; Object.values(items).forEach(it=>{ const li=document.createElement('li'); const disp=convertDisplay(it.qty,it.unit); li.textContent = `${disp.value} ${disp.unit} ${it.name}`; ul.appendChild(li); }); const expJson=document.createElement('button'); expJson.textContent='Exportar JSON'; expJson.className='btn'; expJson.addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(items,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='shopping.json'; a.click(); URL.revokeObjectURL(url); }); sec.appendChild(expJson); const expCsv=document.createElement('button'); expCsv.textContent='Exportar CSV'; expCsv.className='btn'; expCsv.addEventListener('click', ()=>{ const rows=Object.values(items).map(i=>({name:i.name,qty:i.qty,unit:i.unit})); const keys=Object.keys(rows[0]||{}); const header=keys.join(','); const lines=rows.map(r=>keys.map(k=>JSON.stringify(r[k]||'')).join(',')); const csv=[header,...lines].join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='shopping.csv'; a.click(); URL.revokeObjectURL(url); }); sec.appendChild(expCsv); view.appendChild(sec); }); }

  // init: restore search and route
  (function(){ const s=localStorage.getItem('lastSearch')||''; document.getElementById('search').value=s; window.addEventListener('hashchange', navigate); const startHash=location.hash||'#/catalogo'; if(!location.hash) location.hash='#/catalogo'; navigate(); })();

  </script>
</body>
</html>
